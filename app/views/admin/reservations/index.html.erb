<% breadcrumb :admin_reservations %>

<div class="box box-default">
  <div class="box-header with-border">
    <h4 class="box-title"><%= Reservation.model_name.human %>一覧</h4>
  </div>
  <div class="box-header with-border">
    <%= search_form_for @q, url: admin_reservations_path, class: "form-inline" do |f| %>
      <div class='input-group date datepicker'>
        <%= f.text_field :checkin_during_month, data: { :date_format => 'YYYY/MM' }, :class => 'form-control monthPicker', placeholder: '年月を指定' %>
           <span class="input-group-addon">
             <span class="fa fa-calendar"></span>
           </span>
      </div>
      <%= f.select :facility_shop_corporation_id_eq, options_from_collection_for_select(Corporation.all, 'id', 'name', @q.facility_shop_corporation_id_eq), { include_blank: '運営会社を指定' }, { class: 'form-control' } %>
      <%= f.text_field :user_name_cont, placeholder: "ユーザ名前", class: "form-control" %>
      <%= f.select :facility_id_eq, options_from_collection_for_select(Facility.all, 'id', 'name', @q.facility_id_eq), { include_blank: '施設を指定' }, { class: 'form-control' } %>
        <%= f.select :facility_shop_id_eq, options_from_collection_for_select(Shop.all, 'id', 'name', @q.facility_shop_id_eq), { include_blank: '店舖を指定' }, { class: 'form-control' } %>
      <% q = params[:q] || {} %>
      <%= f.submit "検索", class: "btn btn-info w40 mr10" %>
    <% end %>
    <%= link_to "CSVダウンロード", admin_reservations_path(q: request.params[:q], format: 'csv'), class: "btn btn-default w40 mr10" %>
  </div>
  <div class="box-body">
    <table class="table table-striped">
      <thead>
        <tr>
          <th><%= Corporation.human_attribute_name(:name) %></th>
          <th><%= Shop.human_attribute_name(:name) %></th>
          <th><%= Facility.human_attribute_name(:name) %></th>
          <th><%= User.human_attribute_name(:name) %></th>
          <th><%= Reservation.human_attribute_name(:checkin) %></th>
          <th><%= Reservation.human_attribute_name(:checkout) %></th>
          <th><%= Reservation.human_attribute_name(:usage_period) %></th>
          <th><%= Reservation.human_attribute_name(:state) %></th>
          <th><%= Reservation.human_attribute_name(:price) %></th>
        </tr>
      </thead>
      <tbody>
        <% if @reservations.present? %>
          <% @reservations.each do |reservation| %>
            <tr>
              <td><%= reservation.facility.shop.corporation.name %></td>
              <td><%= reservation.facility.shop.name %></td>
              <td><%= reservation.facility.name %></td>
              <td><%= reservation.user.name %></td>
              <td><%= reservation.checkin %></td>
              <td><%= reservation.checkout %></td>
              <td><%= reservation.usage_period %></td>
              <td><%= reservation.state_i18n %></td>
              <td><%= delimiter_price(reservation.price) %></td>
            </tr>
          <% end %>
        <% else %>
          <tr>
            <td colspan="20">
              表示する<%= Reservation.model_name.human %>はありません
            </td>
          </tr>
        <% end %>
      </tbody>
    </table>
    <%= paginate @reservations %>
  </div>
</div>
